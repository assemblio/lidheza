{% extends "layout.html" %}

{% block script %}
    <script>
        $(function() {
            $( ".btn-edit-draft" ).click(function() {
                var campaign_id = $('.form-draft input[id=edit-draft-campaign-id]').val();
                var action = '{{ url_for('publisher.campaign_edit', pid=publisher._id, campaign_id='XXX')}}'.replace('XXX',  campaign_id)
                $('.form-draft').attr('action', action);
                $('.form-draft').submit();
            });
        });

    </script>
    {# $.get( "{{ url_for('publisher.campaign_edit', pid=publisher._id, campaign_id="" ) }}" ); #}
{% endblock %}

{% block rows %}
    <div class="row">
        <div class="col-sm-12">
            <h2>{{ publisher.name }}</h2>
            <h4>Your default rate is <span class="label label-primary">{{ publisher.impressionRate }} EUR</span> per impression (<a href="" data-toggle="modal" data-target="#myModal">edit</a>).</h4>

            <!-- Modal -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Impression Rate</h4>
                  </div>
                    <form action="{{ url_for('publisher.update_impression_rate', pid=publisher._id) }}" method="POST">
                      <div class="modal-body">
                          <div class="form-group">
                              {{ rateform.rate.label }}
                              {{ rateform.rate(class="form-control") }}
                          </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                      </div>
                    </form>
                </div>
              </div>
            </div>
            <hr>
        </div>

        <div class="col-sm-12 text-center" style="padding-bottom:25px;">
            <form action="{{ url_for('publisher.campaign_create', pid=publisher._id) }}" method="GET">
                <input type="submit" class="btn btn-success btn-campaign" value="New Campaign">
            </form>
        </div>


        <div class="col-sm-12">
            <h3>Published:</h3>
            <hr>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Rate</th>
                        <th>Length</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Impressions</th>
                        <th>Current Revenue</th>
                        <th>Projected Revenue</th>
                        <th>Operations</th>
                    </tr>
                </thead>
                <tbody>
                {% for campaign in published_campaigns %}
                    <tr>
                        <td>
                            <a href="{{ campaign.url }}" target="_blank">{{ campaign.name }}</a>
                        </td>
                        <td>
                            {{  campaign.impressions.rate }}
                        </td>
                        <td>
                            {{ (campaign.end - campaign.start).days }} days
                        </td>
                        <td>
                            {{ campaign.start.strftime('%d-%b-%Y') }}
                        </td>
                        <td>
                            {{ campaign.end.strftime('%d-%b-%Y') }}
                        </td>
                        <td>
                            {{ campaign.impressions.count|thousands_seperator }} / {{ campaign.impressions.goal|thousands_seperator }}
                        </td>
                        <td>
                            {{ (campaign.impressions.count * campaign.impressions.rate)|to_currency }}
                        </td>
                        <td>
                            {{ (campaign.impressions.goal * campaign.impressions.rate)|to_currency }}
                        </td>
                        <td>
                            <button type="button" class="btn btn-default btn-primary btn-sm" aria-label="Edit">
                                <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                            </button>
                            <button type="button" class="btn btn-default btn-danger btn-sm" aria-label="Stop">
                                <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
                            </button>
                        </td>
                    </tr>
                </tbody>
                {% endfor %}
            </table>
        </div>

        <div class="col-sm-12">
            <h3>Drafts:</h3>
            <hr>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Rate</th>
                        <th>Length</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Impressions</th>
                        <th>Current Revenue</th>
                        <th>Projected Revenue</th>
                        <th>Operations</th>
                    </tr>
                </thead>
                <tbody>
                {% for campaign in draft_campaigns %}
                    <tr>
                        <td>
                            <a href="{{ campaign.url }}" target="_blank">{{ campaign.name }}</a>
                        </td>
                        <td>
                            {{  campaign.impressions.rate }}
                        </td>
                        <td>
                            {{ (campaign.end - campaign.start).days }} days
                        </td>
                        <td>
                            {{ campaign.start.strftime('%d-%b-%Y') }}
                        </td>
                        <td>
                            {{ campaign.end.strftime('%d-%b-%Y') }}
                        </td>
                        <td>
                            {{ campaign.impressions.count|thousands_seperator }} / {{ campaign.impressions.goal|thousands_seperator }}
                        </td>
                        <td>
                            {{ (campaign.impressions.count * campaign.impressions.rate)|to_currency }}
                        </td>
                        <td>
                            {{ (campaign.impressions.goal * campaign.impressions.rate)|to_currency }}
                        </td>
                        <td>
                            <form class="form-draft" action="" method="GET">
                                <input type="hidden" id="edit-draft-campaign-id" value="{{ campaign._id }}"/>
                                <button type="button" class="btn btn-default btn-primary btn-sm btn-edit-draft" aria-label="Edit">
                                    <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                </button>
                                {% if campaign.assets and campaign.assets|length > 0 %}
                                <button type="button" class="btn btn-default btn-success btn-sm btn-play-draft" aria-label="Play">
                                    <span class="glyphicon glyphicon-play" aria-hidden="true"></span>
                                </button>
                                {% endif %}
                            </form>
                        </td>
                    </tr>
                </tbody>
                {% endfor %}
            </table>
        </div>
    </div>
{% endblock %}